# 🚑 第二阶段踩坑实录 (Troubleshooting)

## 🌐 前后端交互类

### 1. Axios 响应“脱壳”过度
- **现象**: 前端报错 `response.data is not a function`。
- **原因**: 在拦截器中使用了错误的语法 `return response.data()`，`data` 是属性不是方法。
- **修复**: 修改为 `return response.data`。
- **代码位置**: `src/utils/request.js`

### 2. Content-Type 协议不匹配
- **现象**: 报错 `Content-Type 'application/x-www-form-urlencoded;charset=UTF-8' is not supported`。
- **原因**: 
    - 前端 Axios 默认行为：如果参数放在 `params` (URL参数) 发送 POST，某些情况会被视为 Form 表单。
    - 后端 Spring Boot 期望：收到 JSON 格式。
- **修复**: 
    1. 前端：将参数放入 `post` 的第二个参数 (Body) 中发送。
    2. 后端：Controller 参数前加上 `@RequestBody` 注解。

### 3. JSON 反序列化失败
- **现象**: `Cannot deserialize value of type java.lang.Long from Object value`。
- **原因**: 前端发了一个 JSON 对象 `{"itemId": 1, "playerId": 2}`，但后端 Controller 试图用两个单独的 `Long` 参数接收，Spring 无法自动拆解。
- **修复**: 创建 DTO 对象 (如 `BuyRequest`) 来统一接收 JSON 数据。

## ☕ Java 后端类

### 1. MyBatis 插入后 ID 为 Null
- **现象**: 任务插入数据库成功，但返回给前端的对象 `id` 为 null，导致后续操作报错。
- **原因**: MyBatis `insert` 默认不回填主键。
- **修复**: 在 Mapper 接口添加注解：
    ```java
    @Options(useGeneratedKeys = true, keyProperty = "id")
    ```

### 2. 循环依赖/启动卡死
- **现象**: 启动时进程卡住，或者报错 Bean 依赖循环。
- **原因**: `logback.xml` 配置格式错误导致日志系统死锁，或 Service 之间互相注入。
- **修复**: 检查 XML 配置文件格式，理清依赖关系。

## 🖥️ 前端 Vue 类

### 1. 依赖缺失与导入错误
- **现象**: `Failed to resolve import "jwt-decode"`。
- **原因**: 忘记 `npm install` 或者导入语法使用旧版 `v2` 写法。
- **修复**: 
    - 安装: `npm install jwt-decode`
    - 导入: `import { jwtDecode } from 'jwt-decode'` (注意花括号)。

### 2. 登录过期死循环
- **现象**: 登录成功后立刻提示“登录已过期”。
- **原因**: `request.js` 拦截器逻辑中，在检测到 403 时会移除 Token 并强制跳转，但如果逻辑判断过于宽泛，正常登录接口的某些非 200 返回也会触发此逻辑。
- **修复**: 在拦截器中排除 `/login` 和 `/register` 接口的错误拦截。
