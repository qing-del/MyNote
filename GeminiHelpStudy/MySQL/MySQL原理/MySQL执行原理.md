---
title: MySQL执行原理
tags:
 - MySQL
 - 执行原理
 - Learning
create_time: 2026-02-23
---

# 目录

---

## 通信方式
- 客户端通过连接驱动与链接池连接（这个连接通常使用`TCP/IP`协议底层连接）
- 双端采用**半双工模式**通信
	- 在任意时刻，一端发送消息，另一端要**完整**接收才可以响应
	- 客户端用单独数据包传输数据
	- 服务端可以通过设置**最大单次传输上限**来限制大小，超过限制会拒收并抛出异常 ->在[[MySQL大体框架.canvas]]中的**连接器**模块有详细细节

---

## 查询流程

### 查询缓存
- 采用的是 Map 结构，`key = SQL语句`，`value = 查询结果`
- 在 5.7 版本是**默认关闭**的
```sql
-- “查询缓存”开关
show variable like 'query_cache_type';
set query_cache_type=0;

-- query_cache_type=2时，代表按需使用，用SQL_CACHE对某表开启缓存
select SQL_CACHE * FROM test;
```
> [!failure] 在 8.0 之后的版本被移除了，命中率太低了。
> ①缓存查找会消耗性能 -> 慢
> ②如果没找到要新建缓存 -> 慢
> ③如果发生数据写入操作 会使用**表级锁**来保证数据一致 -> 慢
> ④当表内数据修改后 要**批量设置失效** -> 慢


### SQL解析器
- **词法分析**
	- 通过 `sql` / `sql_lex.cc` 将SQL语句切分为各种Token词
	- 利用定义了各类关键字、操作符的数组`symbols[]`进行**关键字**、**非关键字**的标记
	- 例如：
	```sql
	select id from test;
	-- select <-> 关键词
	-- id <-> 非关键词
	-- from <-> 关键词
	-- test <-> 非关键词
	```
- **语法分析**
	- 通过`sql`/`sql_yacc.cc`规则代码将语句解析为了一个”语法树