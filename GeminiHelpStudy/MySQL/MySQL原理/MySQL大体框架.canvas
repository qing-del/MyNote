{
	"nodes":[
		{"id":"cf7ecf52bf936425","type":"group","x":-1960,"y":-360,"width":1320,"height":680,"color":"2","label":"存储引擎"},
		{"id":"38374775b210e17a","type":"group","x":-440,"y":-246,"width":1029,"height":460,"color":"5","label":"Service层"},
		{"id":"c0d3bb8fd11bad5c","type":"group","x":-1940,"y":-293,"width":380,"height":554,"color":"2","label":"硬盘"},
		{"id":"70d573b5ae1e5d51","type":"group","x":-1230,"y":-221,"width":400,"height":361,"color":"2","label":"内存"},
		{"id":"2e3af35d9a0e0af7","type":"group","x":-1510,"y":-271,"width":220,"height":381,"color":"2","label":"操作系统 - 指令"},
		{"id":"8abfe459abf40436","type":"text","text":"### 具体任务\n- 语法校验\n- 语义解析\n- 生成SQL语法树\n\n> ❌若是SQL语句出错，则会返回报错信息","x":-100,"y":-714,"width":250,"height":234},
		{"id":"c3c9f2c1a698a0a5","type":"text","text":"## 日志文件\n- `Undo Log`","x":-1920,"y":70,"width":160,"height":171},
		{"id":"79927f215b70c142","type":"text","text":"## 日志文件\n- `Redo Log`","x":-1740,"y":70,"width":160,"height":171},
		{"id":"0517fa59781a5c41","type":"text","text":"open(O_DIRECT)","x":-1490,"y":-251,"width":180,"height":50},
		{"id":"c88b156ba25c1a3b","type":"text","text":"## 执行器","x":-740,"y":-201,"width":60,"height":201,"color":"2"},
		{"id":"9780fb0f9c1f40e4","type":"text","text":"## 存储引擎\n- 默认是`InnoDB` ","x":-840,"y":-460,"width":200,"height":100,"color":"2"},
		{"id":"e4850da1f8350e55","type":"text","text":"## 磁盘文件\n- `.ibd`","x":-1860,"y":-251,"width":240,"height":147},
		{"id":"c3e09e720b42ba4e","type":"text","text":"### 具体任务\n- TCP接入\n- 身份认证\n- 权限校验\n- 管理连接会话","x":369,"y":-697,"width":250,"height":200},
		{"id":"9e440b78e2b241a8","type":"text","text":"> [!tip] \n> 这里不使用`Page cache`","x":-1480,"y":-90,"width":160,"height":180},
		{"id":"f899e0abdced0c47","type":"text","text":"write","x":-1450,"y":-151,"width":100,"height":50},
		{"id":"095550a29207d39d","type":"text","text":"## IO线程","x":-1210,"y":-201,"width":120,"height":50},
		{"id":"e785837f8fc2b1f7","type":"text","text":"## Redo Log Buffer\n- 防止突发情况导致内存数据丢失","x":-1115,"y":0,"width":235,"height":120},
		{"id":"f163307390fe154d","type":"text","text":"### SQL解析器","x":0,"y":-200,"width":50,"height":200,"color":"5"},
		{"id":"8bdd0aaaa844487d","type":"text","text":"### SQL优化器","x":-390,"y":-200,"width":50,"height":200,"color":"5"},
		{"id":"47b7166a459d9141","type":"text","text":"#### 两个重要的保护参数\n- 最大连接数\n```sql\n-- 限制同时可以发起最大的连接数\nshow variables like 'max_connections';\nset global max_connections=1000;\n```\n> [!info] 补充说明\n> 并非是最多同时执行 1000 条SQL语句\n> 而是可以同时支持同时 1000 个设备连接\n> 不过一般一个连接也就同时执行一条SQL语句\n\n- 单次最大数据报文\n```sql\n-- 单次最大数据报文\nshow variables like 'max_allowed_packet';\n\n-- 单次限制的最大字节数\nset global max_allowed_packet=8388608;\n```\n> [!info] 数据包大小计算\n> 假如执行`insert into xxx values ...;`\n> 那么`数据包总大小` = `一次性SQL语句大小`\n> 就是`insert into user(name) values ('张三'),('李四');`","x":221,"y":240,"width":545,"height":760},
		{"id":"45925767e95f601c","type":"text","text":"## 日志文件(Binlog)\n- `BinLog`\n- 功能：\n\t- 变更历史查询\n\t- 数据库备份和恢复\n\t- 主从复制\n\n> [!info] 细节\n> 会在`Redo`日志写入同时，进行`BinLog`刷盘\n> 刷盘**成功**之后，会告知`Redo`日志事务“已提交”这个信息\n> `Redo`日志会打入“Commit”标记","x":-513,"y":336,"width":465,"height":400},
		{"id":"6526e01e0bb97a17","type":"text","text":"## Buffer Pool\n- 逻辑处理\n- 读取写入","x":-1040,"y":-201,"width":190,"height":182},
		{"id":"3fa270fe2600e710","type":"text","text":"## 二进制缓存日志\n- `Binlog Cache`","x":-390,"y":94,"width":220,"height":100,"color":"5"},
		{"id":"92872261957e4cef","type":"text","text":"```sql\nshow variables like 'innodb_flush_log_at_trx_commit';\n\nset global innodb_flush_log_at_trx_commit=1;\n```\n\n### 刷盘策略\n- **策略一**\n\t- 每次在事务提交前\n\t- 将“更新写入信息”写到**内存** - Redo Log Buffer中\n\t- 与此同时添加到**操作系统**中，并**立刻**进行刷盘\n\t> 这里会使用到`Page cache`\n- **策略零**\n\t- 将“更新写入信息”写到**内存** - Redo Log Buffer中\n\t- **每隔 1 秒钟**，才会用**IO线程**\n\t- 再通过IO，放到操作系统并进行**刷盘**到磁盘文件\n- **策略二**\n\t- 跟**策略零相似**\n\t- 但是是先放到**操作系统**的`Page cache`中\n\t- 再通过**IO线程每秒**刷盘进入到磁盘文件中","x":-1177,"y":600,"width":360,"height":800},
		{"id":"db0119f680a3936c","type":"text","text":"### 链接池\n### SQL接口","x":429,"y":-146,"width":130,"height":92,"color":"5"},
		{"id":"de4724634d67f1b0","type":"text","text":"### 外部使用API调用(JDBC)","x":1220,"y":-132,"width":280,"height":65,"color":"6"}
	],
	"edges":[
		{"id":"d9c799245aa7c92b","fromNode":"47b7166a459d9141","fromSide":"top","toNode":"db0119f680a3936c","toSide":"bottom"},
		{"id":"b65523ede40a955d","fromNode":"de4724634d67f1b0","fromSide":"left","toNode":"db0119f680a3936c","toSide":"right","label":"TCP连接\n从链接池获取已经通过认证身份"},
		{"id":"85646ac0769de275","fromNode":"f163307390fe154d","fromSide":"top","toNode":"8abfe459abf40436","toSide":"bottom"},
		{"id":"81fa0ef561075e83","fromNode":"db0119f680a3936c","fromSide":"top","toNode":"c3e09e720b42ba4e","toSide":"bottom"},
		{"id":"8ced092998099df4","fromNode":"c88b156ba25c1a3b","fromSide":"bottom","toNode":"c3c9f2c1a698a0a5","toSide":"bottom","label":"①准备回滚操作"},
		{"id":"62316f5ea13ea9d7","fromNode":"095550a29207d39d","fromSide":"left","toNode":"e4850da1f8350e55","toSide":"right","label":"⑦"},
		{"id":"b901f79f5c9c4c5f","fromNode":"c88b156ba25c1a3b","fromSide":"left","toNode":"6526e01e0bb97a17","toSide":"right","label":"②"},
		{"id":"915623fe399feee1","fromNode":"e785837f8fc2b1f7","fromSide":"bottom","toNode":"92872261957e4cef","toSide":"top","label":"Redo Log的细节"},
		{"id":"99158eb329a9385e","fromNode":"79927f215b70c142","fromSide":"top","toNode":"e4850da1f8350e55","toSide":"bottom","label":"突发情况重启之后会\n第一时间刷进去保证同步"},
		{"id":"dc92ec1351f0230d","fromNode":"c88b156ba25c1a3b","fromSide":"left","toNode":"e785837f8fc2b1f7","toSide":"right","label":"③"},
		{"id":"5e09d2b1c175ad97","fromNode":"e785837f8fc2b1f7","fromSide":"left","toNode":"79927f215b70c142","toSide":"right","label":"④"},
		{"id":"33c5c9990cd3c8a8","fromNode":"45925767e95f601c","fromSide":"left","toNode":"79927f215b70c142","toSide":"bottom","label":"⑥"},
		{"id":"b964d7b71ef70031","fromNode":"3fa270fe2600e710","fromSide":"bottom","toNode":"45925767e95f601c","toSide":"top","label":"⑤"},
		{"id":"af7fdcb48480c0d5","fromNode":"8bdd0aaaa844487d","fromSide":"left","toNode":"c88b156ba25c1a3b","toSide":"right"},
		{"id":"d7df70650ba36450","fromNode":"db0119f680a3936c","fromSide":"left","toNode":"f163307390fe154d","toSide":"right"},
		{"id":"27057b3eaaabeef1","fromNode":"f163307390fe154d","fromSide":"left","toNode":"8bdd0aaaa844487d","toSide":"right"}
	]
}