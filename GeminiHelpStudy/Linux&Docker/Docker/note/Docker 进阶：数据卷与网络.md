---
title: Docker è¿›é˜¶ï¼šæ•°æ®å·ä¸ç½‘ç»œ
tags:
  - Docker
  - Volume
  - Network
create_time: 2026-01-26
---

## 1. æ•°æ®å· (Data Volumes)

### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®å·ï¼Ÿ
**æ•°æ®å·**æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼Œæ˜¯**å®¹å™¨å†…ç›®å½•**ä¸**å®¿ä¸»æœºç›®å½•**ä¹‹é—´æ˜ å°„çš„æ¡¥æ¢ã€‚
- **ä½œç”¨**ï¼š
    1. **æ•°æ®æŒä¹…åŒ–**ï¼šå®¹å™¨åˆ é™¤åï¼Œæ•°æ®ä¾ç„¶ä¿ç•™åœ¨å®¿ä¸»æœºã€‚
    2. **æ•°æ®å…±äº«**ï¼šæ–¹ä¾¿åœ¨å®¿ä¸»æœºæ“ä½œå®¹å™¨å†…æ–‡ä»¶ï¼Œæˆ–åœ¨å¤šå®¹å™¨é—´å…±äº«æ•°æ®ã€‚

![[Dockerå­¦ä¹ 6.png]]

### 1.2 æ•°æ®å·æ“ä½œå‘½ä»¤
| å‘½ä»¤ | è¯´æ˜ |
| :--- | :--- |
| `docker volume create` | åˆ›å»ºæ•°æ®å· |
| `docker volume ls` | æŸ¥çœ‹æ‰€æœ‰æ•°æ®å· |
| `docker volume inspect` | æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…ï¼ˆå¦‚æŒ‚è½½è·¯å¾„ï¼‰ |
| `docker volume prune` | æ¸…é™¤æœªä½¿ç”¨çš„æ‰€æœ‰æ•°æ®å· |


### 1.3 æŒ‚è½½æ–¹å¼å¯¹æ¯”

#### æ–¹å¼ä¸€ï¼šæ•°æ®å·æŒ‚è½½ (Volume)
å®¿ä¸»æœºç›®å½•ç”± Docker è‡ªåŠ¨ç®¡ç†ï¼ˆé€šå¸¸åœ¨ `/var/lib/docker/volumes/`ï¼‰ã€‚
```bash
# -v æ•°æ®å·å:å®¹å™¨è·¯å¾„
docker run -d --name nginx -v html:/usr/share/nginx/html nginx
```

> [!note]
> å¦‚æœæ•°æ®å· `html` ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

#### æ–¹å¼äºŒï¼šæœ¬åœ°ç›®å½•æŒ‚è½½ (Bind Mount)

ç›´æ¥æŒ‡å®šå®¿ä¸»æœºçš„å…·ä½“è·¯å¾„ï¼Œé€‚åˆå¼€å‘è°ƒè¯•ã€‚

```bash
# -v å®¿ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„
docker run -d --name mysql \
  -v /root/mysql/data:/var/lib/mysql \
  mysql:8
```

> [!warning] æ³¨æ„
> æœ¬åœ°ç›®å½•å¿…é¡»ä»¥ `/` æˆ– `./` å¼€å¤´ï¼Œå¦åˆ™ä¼šè¢«è¯†åˆ«ä¸ºæ•°æ®å·åã€‚

##### ğŸ› ï¸å¤„ç†è¦†ç›–å¼æŒ‚è½½çš„æœºåˆ¶
1. å…ˆä¸æŒ‚è½½æ•°æ®å·ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶å®¹å™¨
```bash
sudo docker run -d --name temp-nginx nginx:1.20.2
```
2. å°†ä¸´æ—¶å®¹å™¨å†…éœ€è¦æŒ‚è½½çš„æ–‡ä»¶é»˜è®¤å†…å®¹å…ˆæ‹·è´åˆ°å®¿ä¸»æœºçš„æŒ‚è½½ç›®å½•
```bash
# æ³¨æ„ï¼šå‘½ä»¤æ ¼å¼æ˜¯ docker cp å®¹å™¨å:å®¹å™¨è·¯å¾„ å®¿ä¸»æœºè·¯å¾„
sudo docker cp temp-nginx:/usr/share/nginx/html ./

# åˆ é™¤å®¹å™¨
sudo docker rm -f temp-nginx
```
3. å†æ¬¡åˆ›å»ºå®¹å™¨ï¼Œå¹¶è¿›è¡Œæœ¬åœ°æŒ‚è½½
```bash
sudo docker run -d \
  --name taskweb \
  -p 80:80 \
  -v $(pwd)/html:/usr/share/nginx/html \
  nginx:1.20.2
```

> [!warning] æ³¨æ„æ–‡ä»¶æƒé™
> æ¯”å¦‚ï¼š`MySQL`æœ‰æ—¶å€™ä¼šå› ä¸ºæ²¡æœ‰è¯»å–æƒé™å¯¼è‡´å¯åŠ¨å¤±è´¥
> å¯ä»¥ä½¿ç”¨`chmod 777 -r [ç›®æ ‡æ–‡ä»¶/æ–‡ä»¶å¤¹]` æ¥ä¿®æ”¹æƒé™

### æ‰©å±•ï¼šæŒ‚è½½é…ç½®æ–‡ä»¶
- å°† Java é¡¹ç›®æ‰“åŒ…ä¹‹åï¼Œä¼šå˜æˆä¸€ä¸ª jar åŒ…ï¼Œä½†æ˜¯é‡Œé¢ä¼šæœ‰ä¸€ä¸ª `application.yml` çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä½•è®©é¡¹ç›®è¯»å–å¯ä»¥ä¿®æ”¹åˆ°çš„**é…ç½®æ–‡ä»¶**å‘¢ï¼Ÿ
	- å¯ä»¥é€šè¿‡å¯¹`[å·¥ä½œç›®å½•]/application.yml`è¿›è¡Œä¸€ä¸ªæŒ‚è½½ï¼Œç„¶åå¯ä»¥ä¿®æ”¹é‡Œé¢çš„é…ç½®ï¼Œæ‰“åŒ…å¥½çš„ jar åŒ…è¿è¡Œçš„æ—¶å€™ä¼šä¼˜å…ˆè¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶
- **æ—¥å¿—é…ç½®æ–‡ä»¶**
	- è¦å¯¹`Dockerfile`ä¸­ä½¿ç”¨å¦‚ä¸‹å¯åŠ¨å‘½ä»¤
		```bash
		ENTRYPOINT ["java", "-Dlogging.config=/app/logback.xml", "-jar", "app.jar"]
		```
	- ç„¶åæŒ‚è½½`[å·¥ä½œç›®å½•]/logback.xml`çš„æ•°æ®å·å³å¯

---

## 2. Docker ç½‘ç»œ (Network)

### 2.1 é»˜è®¤ç½‘ç»œ (Bridge)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨é€šè¿‡ Docker çš„è™šæ‹Ÿç½‘æ¡¥ (`docker0`) è¿æ¥ã€‚è™½ç„¶å¯ä»¥é€šè¿‡ IP äº’é€šï¼Œä½† IP åœ°å€å¯èƒ½ä¼šå˜åŠ¨ï¼Œä¸é€‚åˆç¡¬ç¼–ç ã€‚

![[Dockerå­¦ä¹ 17.png]]

### 2.2 è‡ªå®šä¹‰ç½‘ç»œ

åŠ å…¥è‡ªå®šä¹‰ç½‘ç»œçš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡**å®¹å™¨å**ï¼ˆContainer Nameï¼‰ç›´æ¥äº’ç›¸è®¿é—®ï¼Œæ— éœ€å…³å¿ƒ IP å˜åŒ–ï¼ˆå†…ç½® DNS è§£æï¼‰ã€‚

### 2.3 ç½‘ç»œæ“ä½œå‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
| --- | --- |
| `docker network create` | åˆ›å»ºä¸€ä¸ªç½‘ç»œ |
| `docker network ls` | æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ |
| `docker network connect` | å°†å®¹å™¨åŠ å…¥ç½‘ç»œ |
| `docker network inspect` | æŸ¥çœ‹ç½‘ç»œè¯¦æƒ… |

**å®æˆ˜ç¤ºä¾‹**ï¼š

```bash
# 1. åˆ›å»ºç½‘ç»œ
docker network create my-net

# 2. è¿è¡Œå®¹å™¨å¹¶åŠ å…¥ç½‘ç»œ
docker run -d --name mysql --network my-net mysql:8
docker run -d --name java-app --network my-net my-java-image

# 3. æ­¤æ—¶ java-app å¯ä»¥ç›´æ¥é€šè¿‡ "mysql" è¿™ä¸ªåå­—è¿æ¥æ•°æ®åº“
```

### 2.4 Nginx åå°„ä»£ç†
- ä½¿ç”¨ Vue 3 æ„å»ºçš„é¡¹ç›®
- å¯¹`request.js`ä¿®æ”¹
```javascript
// åˆ›å»º Axios å®ä¾‹
const request = axios.create({
    baseURL: '/api', // è¿™é‡Œæ”¹ä¸ºç›¸å¯¹è·¯å¾„
    timeout: 5000
})
```

- å¯¹`nginx.conf`æˆ–è€…æ˜¯`default.conf`è¿›è¡Œä¿®æ”¹
```nginx
# è¿™é‡Œä½¿ç”¨ default.conf æ¥ä½œä¸ºç¤ºä¾‹
server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    # 1. å‰ç«¯é™æ€èµ„æºä½ç½®
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        # ã€æ–°å¢ã€‘è§£å†³ Vue è·¯ç”±åˆ·æ–°å 404 çš„é—®é¢˜
        try_files $uri $uri/ /index.html;
    }

    # 2. åå‘ä»£ç†é…ç½®
    location ^~ /api/ {
        # ã€å…³é”®ä¿®æ”¹ã€‘å¦‚æœä½ çš„åç«¯æ¥å£æœ¬èº«ä¸å¸¦ /api å‰ç¼€ï¼ˆä¾‹å¦‚ï¼š/user/loginï¼‰
        # é‚£ä¹ˆéœ€è¦ç”¨ rewrite å‰¥ç¦»æ‰è¯·æ±‚ä¸­çš„ /api
        rewrite ^/api/(.*)$ /$1 break;

        # ã€å…³é”®ä¿®æ”¹ã€‘æ”¹ä¸ºä½ åç«¯çš„çœŸå® IP å’Œç«¯å£ 8080
        # å¦‚æœä½ æ²¡ç”¨è‡ªå®šä¹‰ç½‘ç»œï¼Œè¯·ç¡®è®¤åç«¯å®¹å™¨çš„ IP ä¾ç„¶æ˜¯ 172.17.0.4
        proxy_pass http://[åç«¯å®¹å™¨åå­—]:8080;

        # ã€å»ºè®®æ–°å¢ã€‘ä¼ é€’çœŸå®çš„å®¢æˆ·ç«¯ä¿¡æ¯ç»™åç«¯
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```