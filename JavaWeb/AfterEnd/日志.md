# 日志技术
## 目录
[日志框架](#日志框架)
[快速入门](#快速入门)
[配置文件详解](#配置文件详解)
[完整 logback.xml 示例](#完整-logbackxml-示例)

### 日志框架
* **JUL**： 这是 JavaSE 平台提供的官方日志框架
    * 优点：配置简单
    * 缺点：不够灵活，性能较差
* **Log4j**： 这是 Apache 提供的日志框架
    * 优点：功能强大，灵活性高，支持多种输出目标
* **Logback**： 这是 Log4j 的升级，提供更好的性能和更多功能
    * 优点：性能更好，配置更灵活，支持 SLF4J 接口，性能优于 Log4j
* **Slf4j (Simple Logging Facade for Java)**： 简单日志门面，提供了一套日志操作的标准接口以及抽象类，允许应用程序使用不同的底层日志框架

> 接下来使用 Logback 作为日志框架的示例。
### 快速入门
* **准备工作**： 引入 logback 的依赖（springboot 项目中该依赖已传递）、配置文件 logback.xml
* **记录日志**： 定义日志记录对象 Logger，记录日志

<details>
<summary>依赖地址（pom.xml）</summary>

```xml
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
    <version>1.4.11</version>
</dependency>
```

</details>

<details>
<summary>使用示例</summary>

```java
//@Slf4j
@SpringBootTest
class LogTest {
    // 此行可以用 @Slf4j 注解代替
    private static final Logger log = LoggerFactory.getLogger(LogTest.class);
    @Test
    public void testLog() {
        log.debug("debug...");
        int sum = 0;
        int[] nums = {1, 2, 3, 4, 5};
        for (int num : nums) {
            sum += num;
            log.info("当前数字：{}", num);
        }
        log.info("结果为：{}", sum);
        log.debug("end...");
    }
}
```

</details>


### 配置文件详解
* **logback.xml**： Logback 的配置文件，通常放在 src/main/resources 目录下
* **输出方式**： Logback 支持多种输出方式，包括控制台输出、文件输出等
    * **控制台输出**：
    ```xml
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    ...
    </appender>
    ```
    * **文件输出**：
    ```xml
    <appender name="FILE" class="ch.qos.logback.core.RollingFileAppender">
    ...
    </appender>
    ```

* **日志级别**： 开启日志（ALL），关闭日志（OFF）
```xml
<root level="debug">
    <appender-ref ref="STDOUT" />
    <appender-ref ref="FILE" />
</root>
```
> ALL < Trace < Debug < Info < Warn < Error < Fatal < OFF （level属性）
> 大于等于配置的日志级别的日志才会输出

> ref 属性对应 appender 中的 name 属性


### 完整 logback.xml 示例
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    <!-- 控制台输出 -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
                <!-- 格式化输出：%d表示日期，%thread表示线程名称，%-5level：表示占5个字符宽度（不足用空格），%msg：日志消息，%n是换行符） -->
                <!-- %logger{50}：最长50个字符（超出长度部分将被截断）（或者是对完整名字进行简化） -->
                <!-- SSS 表示毫秒值 -->
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            </encoder>
    </appender>

    <!-- 系统文件输出 -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 输出策略 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFileNamingAndTriggeringPolicy">
            <!-- 添加 encoder -->
            <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            </encoder>
            <!--日志文件保存的文件夹 ${LOG_HOME} 表示获取系统变量 LOG_HOME 的值 -->
<!--        <fileNamePattern>${LOG_HOME}/tlias-web-management.%d{yyyy-MM-dd}.%i.log</fileNamePattern>-->

            <!-- 日志文件保存的文件名 -->
            <!-- %i 表示滚动次数，默认为0 -->
            <FileNamePattern>E:/JavaProject/web01/tlias-web-management/src/main/resources/log/tlias-%d{yyyy-MM-dd}-%i.log</FileNamePattern>

            <!-- 最多保留的历史日志文件的数量 -->
            <MaxHistory>30</MaxHistory>

            <!-- 日志文件最大的大小 -->
            <MaxFileSize>10MB</MaxFileSize>

        </rollingPolicy>
    </appender>

    <!-- 日志输出级别  -->
    <root level="Debug">
        <appender-ref ref="STDOUT"/>
        <appender-ref ref="File"/>
    </root>
</configuration>
```