# MyBatis 自定义封装

### 前置信息
* 员工实体类
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Emp {
    private Integer id;
    private String username;
    private String password;
    private String name;
    private Integer gender;
    private String image;
    private LocalDate entryDate;
    private Integer deptId;
    private LocalDateTime createDate;
    private LocalDateTime updateDate;

    // 部门名称
    private String deptName;

    // 员工工作经历
    private List<EmpExpr> exprList;
}
```
* 员工工作经历实体类
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class EmpExpr {
    private Integer id;
    private String begin;
    private String end;
    private String company;
    private String job;
    private Integer empId;
}
```

* Emp表
```sql
CREATE TABLE `emp` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID，主键',
  `username` varchar(20) NOT NULL COMMENT '用户名',
  `password` varchar(32) DEFAULT '123456' COMMENT '密码',
  `name` varchar(10) NOT NULL COMMENT '姓名',
  `gender` tinyint unsigned NOT NULL COMMENT '性别，1：男，2：女',
  `phone` char(11) NOT NULL COMMENT '手机号',
  `job` tinyint unsigned DEFAULT NULL COMMENT '职位，1：班主任，2：讲师，3：学工主管，4：教研主管，5：咨询师',
  `salary` int unsigned DEFAULT NULL COMMENT '薪资',
  `image` varchar(255) DEFAULT NULL COMMENT '头像',
  `entry_date` date NOT NULL COMMENT '入职时间',
  `dept_id` int unsigned DEFAULT NULL COMMENT '部门ID',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime DEFAULT NULL COMMENT '修改时间',
  PRIMARY KEY (`id`)
) commit '员工表';
```

* EmpExpr表
```sql
CREATE TABLE `emp_expr` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID，主键',
  `begin` date DEFAULT NULL COMMENT '开始时间',
  `end` date DEFAULT NULL COMMENT '结束时间',
  `company` varchar(50) DEFAULT NULL COMMENT '公司名称',
  `job` varchar(50) DEFAULT NULL COMMENT '职位',
  `emp_id` int unsigned DEFAULT NULL COMMENT '员工ID',
  PRIMARY KEY (`id`)
) commit '工作经历表'
```

### MyBatis 自定义封装案例
* 需求：使用外连接查询员工的基本信息和工作经历信息
* **SQL 语句编写**
```sql
select
    e.*,
    ee.id ee_id,
    ee.begin ee_begin,
    ee.end ee_end,
    ee.company ee_company,
    ee.job ee_job,
    ee.emp_id ee_emp_id
from emp e left join emp_expr ee on e.id = ee.emp_id
where e.id = 1;
```

* XML 映射文件
```xml
<!-- 根据ID查询员工基本信息和员工工作经历信息 -->
<mapper namespace="com.example.mapper.EmpMapper"> 
    <!-- 使用自定义封装 -->
    <resultMap id="empResultMap" type="com.example.pojo.Emp">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="name" property="name"/>
        <result column="password" property="password"/>
        <result column="gender" property="gender"/>
        <result column="image" property="image"/>
        <result column="entry_date" property="entryDate"/>
        <result column="dept_id" property="deptId"/>
        <result column="create_date" property="createDate"/>
        <result column="update_date" property="updateDate"/>
        <!-- 封装exprList -->
        <collection property="exprList" ofType="com.example.pojo.EmpExpr">
            <id column="ee_id" property="id"/>
            <result column="ee_begin" property="begin"/>
            <result column="ee_end" property="end"/>
            <result column="ee_company" property="company"/>
            <result column="ee_job" property="job"/>
            <result column="emp_id" property="empId"/>
        </collection>
    </resultMap>

    <select id="getInfo" resultType="empResultMap">
        select
            e.*,
            ee.id ee_id,
            ee.begin ee_begin,
            ee.end ee_end,
            ee.company ee_company,
            ee.job ee_job
        from emp e left join emp_expr ee on e.id = ee.emp_id
        where e.id = #{id}
    </select>
</mapper>
```

> 注意：此时 \<select> 标签中的 resultType 属性引用了自定义封装的 resultMap 中的 id 属性 