# 删除员工

### 前置信息
* 在 MySQL 中创建了两个跟员工相关的表
    1. `emp`：员工表
    2. `emp_expr`：员工经历表
* 在 `阿里云 OSS` 中创建了用于保存 员工头像 的存储 `bucket`

### 请求方式
1. 基本信息
    * 请求路径：`/emps`
    * 请求方式：`DELETE`
2. 请求参数
    * 参数格式：查询参数
    * 请求参数样例：`/emps?ids=1,2,3`
    * 参数说明：

| 参数名 | 类型 | 示例 | 是否必须 | 备注 |
|--------|------|------|----------|------|
| ids | 数组 array | 1,2,3 | 必须 | 员工的id数组 |

### SQL 语句编写
* 先删除员工的基本信息
* 再删除员工的工作经历信息
```sql
-- 1. 删除员工基本信息
delete from emp where id in (1,2,3);
-- 2. 删除员工工作经历信息
delete from emp_expr where emp_id in (1,2,3);
```

### 接收请求参数
* 接收参数： `DELETE` `/emps?ids=1,2,3`
* 方式一：通过数组来接收
```java
@DeleteMapping("/emps")
public Result delete(Integer[] ids) {
    ...   
    return Result.success();
}
```

* 方式二： **（推荐）** 通过 **@RequestParam** 在集合中来接收
```java
@DeleteMapping("/emps")
public Result delete(@RequestParam List<Integer> ids) {
    ...
    return Result.success();
}
```

### 逻辑实现
* **Controller 层**

    <details>
    <summary>查看代码</summary>
    
    ```java
    @RestController
    @RequestMapping("/emps")
    public class EmpController {
    
        @Autowired
        private EmpService empService;
    
        @DeleteMapping
        public Result delete(@RequestParam List<Integer> ids) {
            empService.deleteEmps(ids);
            return Result.success();
        }
    }
    ```
    </details>

    <br>

* **Service 层**

    <details>
    <summary>查看代码</summary>
    
    ```java
    public interface EmpService {
        public void deleteEmpsByIds(List<Integer> ids);
    }
    ```
    ```java
    @Service
    public class EmpServiceImpl implements EmpService { 
        @Autowired
        private EmpMapper empMapper;
        @Override
        public void deleteEmpsByIds(List<Integer> ids) {
            // 1.批量删除员工基本信息
            empMapper.deleteByIds(ids);

            // 2. 批量删除员工工作经历信息
            empExprMapper.deleteByIds(ids);
        }
    }
    ```

    </details>

    <br>

* **Mapper 层**

    <details>
    <summary>查看代码（Emp）</summary>

    ```java
    @Mapper
    public interface EmpMapper {
        // 这里采用 XML 映射文件编写 SQL 语句
        void deleteByIds(List<Integer> ids);
    }
    ```

    ```xml
    <mapper namespace="com.example.mapper.EmpMapper">
        <delete id="deleteByIds">
            delete from emp where id in
            <foreach collection="ids", item="id", separator="," open="(" close=")">
                #{id}
            </foreach>
        </delete>
    </mapper>
    ```

    </details>

    <details>
    <summary>查看代码（EmpExpr）</summary>
    
    ```java
    @Mapper
    public interface EmpExprMapper {
        int deleteByIds(List<Integer> empIds);
    }
    ```

    ```xml
    <mapper namespace="com.example.mybatis.demo.mapper.EmpExprMapper"> 
        <delete id="deleteByIds">
            delete from emp_expr where emp_id in
            <foreach collection="empIds", item="empId", separator=",", open="(" close=")">
                #{empId}
            </foreach>
        </delete>
    </mapper>
    ```

    </details>

