# 查询员工
## 目录
- [请求方式](#请求方式)
- [SQL 语句编写](#sql-语句编写)
- [逻辑实现](#逻辑实现)

### 请求方式
1. 基本信息
    * 请求路径：`/emps/{id}`
    * 请求方式：`GET`
2. 请求参数
    * 参数格式：路径参数
    * 请求参数样例：`/emps/1`
    * 参数说明：

| 参数名 | 类型 | 是否必须 | 备注 |
|--------|------|----------|------|
| id | number | 必须 | 员工的id |

3. 响应数据
    * 参数格式：`application/json`
    * 参数说明：

<details>
<summary>查看响应数据</summary>

```json
{
    "code": 1,
    "message": "success",
    "data": {
        "id": 2,
        "username": "zhangwuji",
        "name": "张无忌",
        "gender": 1,
        "image": "https://example.com/image.jpg",
        "job": 2,
        "salary": 8000,
        "entryDate": "2015-01-01",
        "deptId": 2,
        "createDate": "2022-09-01T23:06:30",
        "updateDate": "2022-09-02T00:29:04",
        "exprList": [
            {
                "id": 1,
                "begin": "2012-07-01",
                "end": "2019-03-03",
                "company": "百度科技股份有限公司",
                "job": "Java开发",
                "empId": 2
            },
            {
                "id": 2,
                "begin": "2019-03-15",
                "end": "2023-03-01",
                "company": "阿里巴巴科技股份有限公司",
                "job": "架构师",
                "empId": 2
            }
        ]
    }
}
```

</details>

### SQL 语句编写
* **逻辑分析**： 员工有可能是会没有工作经历，所以要使用外连接来查询
```sql
select 
    e.*,
    ee.id ee_id,
    ee.begin ee_begin,
    ee.end ee_end,
    ee.company ee_company,
    ee.job ee_job
from emp e left join emp_expr ee on e.id = ee.emp_id
where e.id = 59;
```

### 逻辑实现
* **Controller 层**

    <details>
    <summary>查看代码</summary>

    ```java
    @RestController
    @RequestMapping("/emps")
    public class EmpController {
        @Autowired
        private EmpService empService;

        @GetMapping("/{id}")
        public Result getInfo(@PathVariable Integer id) {
            log.info("根据id查询员工信息，id：{}", id);
            Emp emp = empService.getInfo(id);
            return Result.success(emp);
        }
    }
    ```

    </details>

<br>

* **Service 层**

    <details>
    <summary>查看代码</summary>

    ```java
    public interface EmpService { 
        Emp getInfo(Integer id);
    }
    ```

    ```java
    @Service
    public class EmpServiceImpl implements EmpService { 
        @Autowired
        private EmpMapper empMapper;

        @Override
        public Emp getInfo(Integer id) {
            return empMapper.getInfo(id);
        }
    }
    ```

    </details>

<br>

* **Mapper 层**

    <details>
    <summary>查看代码</summary>

    ```java
    @Mapper
    public interface EmpMapper { 
        Emp getInfo(Integer id);
    }
    ```

    > 由于 SQL 语句比较复杂，所以使用 XML 方式来编写 SQL 语句

    ```xml
    <!-- 根据ID查询员工基本信息和员工工作经历信息 -->
    <mapper namespace="com.example.mapper.EmpMapper"> 
        <!-- 使用自定义封装 -->
        <resultMap id="empResultMap" type="com.example.pojo.Emp">
            <id column="id" property="id"/>
            <result column="username" property="username"/>
            <result column="name" property="name"/>
            <result column="password" property="password"/>
            <result column="gender" property="gender"/>
            <result column="image" property="image"/>
            <result column="entry_date" property="entryDate"/>
            <result column="dept_id" property="deptId"/>
            <result column="create_date" property="createDate"/>
            <result column="update_date" property="updateDate"/>
            <!-- 封装exprList -->
            <collection property="exprList" ofType="com.example.pojo.EmpExpr">
                <id column="ee_id" property="id"/>
                <result column="ee_begin" property="begin"/>
                <result column="ee_end" property="end"/>
                <result column="ee_company" property="company"/>
                <result column="ee_job" property="job"/>
                <result column="emp_id" property="empId"/>
            </collection>
        </resultMap>

        <select id="getInfo" resultType="empResultMap">
            select
                e.*,
                ee.id ee_id,
                ee.begin ee_begin,
                ee.end ee_end,
                ee.company ee_company,
                ee.job ee_job
            from emp e left join emp_expr ee on e.id = ee.emp_id
            where e.id = #{id}
        </select>
    </mapper>
    ```

    </details>